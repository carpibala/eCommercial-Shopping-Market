<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Registration - Super NiuBi Market</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="js/api.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        body{
            background:#101010;color:#F0F0F0;
            font-family:'Microsoft YaHei',Arial,sans-serif;
            min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;
        }
        .main-header{
            position:absolute;top:0;width:100%;
            background:#1a1a1a;padding:18px 5%;display:flex;justify-content:space-between;align-items:center;
            box-shadow:0 2px 15px rgba(0,0,0,.6);backdrop-filter:blur(10px);
        }
        .logo{font-size:28px;font-weight:bold;color:#00FFFF;text-decoration:none;}

        h1{
            font-size:3.2em;color:#00FFFF;text-align:center;margin-bottom:50px;
            text-shadow:0 0 30px rgba(0,255,255,.8);
        }

        .form-container{
            max-width:520px;margin:0 auto;padding:40px;
            background:#181818;border-radius:28px;
            box-shadow:0 20px 60px rgba(0,255,255,.15),0 0 80px rgba(0,255,255,.1);
            border:1px solid #333;
        }

        .role-selector{
            display:flex;margin-bottom:40px;border-radius:16px;overflow:hidden;
            border:1px solid #444;
        }
        .role-btn{
            flex:1;padding:18px;background:#222;color:#ccc;
            font-size:1.3em;font-weight:bold;cursor:pointer;transition:all .4s;
        }
        .role-btn.active{
            background:#00FFFF;color:#000;box-shadow:0 0 20px rgba(0,255,255,.6);
        }
        .role-btn:not(.active):hover{background:#333;color:#FF4700;}

        .auth-form{display:none;padding:20px;}
        .auth-form.active{display:block;animation:fadeIn .5s;}
        @keyframes fadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}

        .auth-form label{
            display:block;margin:25px 0 10px;font-size:1.15em;color:#aaa;
        }
        .auth-form input{
            width:100%;padding:16px;background:#111;border:1px solid #444;
            border-radius:12px;color:white;font-size:1.1em;transition:border .3s;
        }
        .auth-form input:focus{
            outline:none;border-color:#00FFFF;box-shadow:0 0 0 4px rgba(0,255,255,.2);
        }

        .form-links{text-align:center;margin:30px 0;}
        .form-links a{color:#00FFFF;font-size:1.1em;}
        .form-links a:hover{color:#ff00aa;}

        .btn-submit-form{
            width:100%;margin-top:35px;padding:20px;
            background:linear-gradient(135deg,#00FFFF,#00f7ff);color:#000;
            border:none;border-radius:16px;font-size:1.6em;font-weight:bold;
            cursor:pointer;transition:all .4s;box-shadow:0 10px 30px rgba(0,255,255,.4);
        }
        .btn-submit-form:hover{
            transform:translateY(-5px);box-shadow:0 15px 40px rgba(0,255,255,.6);
        }
    </style>
</head>
<body>

<header class="main-header">
    <div class="logo"><a href="index.html">Super NiuBi Market</a></div>
</header>

<main>
    <h1>Welcome to Join Us</h1>

    <div class="form-container">
        <div class="role-selector">
            <button type="button" id="buyerBtn" class="role-btn active">I'm a Buyer</button>
            <button type="button" id="sellerBtn" class="role-btn">I'm a Seller</button>
        </div>

        <!-- Buyer Registration -->
        <form id="buyerRegForm" class="auth-form active">
            <label>Username</label>
            <input type="text" id="buyerName" required placeholder="For login and display">
            <label>Email</label>
            <input type="email" id="buyerEmail" required placeholder="Receive order notifications">
            <label>Password</label>
            <input type="password" id="buyerPassword" required minlength="6" placeholder="At least 6 characters">
            <div class="form-links"><a href="login.html">Already have an account? Login →</a></div>
            <button type="submit" class="btn-submit-form">Register as Buyer</button>
        </form>

        <!-- Seller Registration -->
        <form id="sellerRegForm" class="auth-form">
            <label>Store Name</label>
            <input type="text" id="sellerName" required placeholder="Your brand/store name">
            <label>Contact Email</label>
            <input type="email" id="sellerEmail" required placeholder="For receiving orders">
            <label>Password</label>
            <input type="password" id="sellerPassword" required minlength="6" placeholder="At least 6 characters">
            <label>Business License Number (Simulated)</label>
            <input type="text" id="sellerLicense" required placeholder="For identity verification only">
            <div class="form-links"><a href="login.html">Already have an account? Login →</a></div>
            <button type="submit" class="btn-submit-form">Register as Seller</button>
        </form>
    </div>
</main>

<script>
// Unified registration success handler (Same as login.html)
function saveLogin(data) {
    localStorage.setItem('token', data.token);
    localStorage.setItem('user', JSON.stringify(data.user));
    alert('Registration successful! Welcome ' + data.user.name);

    if (data.user.role === 'seller') {
        location.href = 'seller_dashboard.html';
    } else {
        location.href = 'index.html';
    }
}

// Buyer registration
$('#buyerRegForm').submit(async function(e) {
    e.preventDefault();
    const name = $('#buyerName').val().trim();
    const email = $('#buyerEmail').val().trim();
    const password = $('#buyerPassword').val();

    if (!name || !email || !password) {
        alert('Please fill in all fields');
        return;
    }

    try {
        const data = await API.post('/auth/register', {
            name,
            email,
            password,
            role: 'user'
        });
        saveLogin(data);
    } catch (err) {
        alert(err.message || 'Registration failed, email may already be in use');
    }
});

// Seller registration (Fixed critical bug!)
$('#sellerRegForm').submit(async function(e) {
    e.preventDefault();
    const name = $('#sellerName').val().trim();        // Store name
    const email = $('#sellerEmail').val().trim();
    const password = $('#sellerPassword').val();
    const license = $('#sellerLicense').val().trim(); // Business license number

    if (!name || !email || !password || !license) {
        alert('Please fill in all fields');
        return;
    }

    try {
        const data = await API.post('/auth/register', {
            name,
            email,
            password,
            role: 'seller',
            companyName: name,      // Backend field is companyName
            license                 // Optional field
        });
        saveLogin(data);
    } catch (err) {
        alert(err.message || 'Registration failed, email may already be in use');
    }
});

// Role switching
$(document).ready(function() {
    $('#buyerBtn').click(() => {
        $('.role-btn').removeClass('active');
        $('#buyerBtn').addClass('active');
        $('.auth-form').removeClass('active');
        $('#buyerRegForm').addClass('active');
    });
    $('#sellerBtn').click(() => {
        $('.role-btn').removeClass('active');
        $('#sellerBtn').addClass('active');
        $('.auth-form').removeClass('active');
        $('#sellerRegForm').addClass('active');
    });
});
</script>

</body>
</html>